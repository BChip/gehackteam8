<!doctype html>

<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>px-vis-timeseries Demo</title>
        <!-- Requires Webcomponents.js polyfill is provided by the page for browsers that don't support html imports -->
        <script src="../webcomponentsjs/webcomponents-lite.min.js"></script>
        <!-- Import custom element. Note: see comment about relative paths to dependencies in the *.html file referenced below -->

        <link rel="import" href="../px-theme/px-theme-styles.html">
        <!-- <link rel="import" href="../px-dark-theme/px-dark-theme-styles.html"> -->
        <style include="px-theme-styles" is="custom-style"></style>

        <link rel="import" href="px-vis-timeseries.html"/>
        <link rel="import" href="../iron-ajax/iron-ajax.html"/>
        <link rel="import" href="../px-rangepicker/px-rangepicker.html"/>
        <link rel="import" href="../px-vis/px-vis-toolbar.html"/>
        <link rel="import" href="../px-vis/px-vis-data-converter.html"/>

    </head>

    <body style="padding:30px; ">
    <!-- <body style="padding:30px; background-color: rgb(27,42,51);"> -->
      <template id="template" is="dom-bind">
        <h2>Example of a timeseries with many options and using old data format with the data converter</h2>
        <br/>
        <px-vis-toolbar
          current-sub-config='{{toolbarSubConfig}}'
          action-config='{{actionConfig}}'
          horizontal-alignment='left'
          id="toolbar"
          toolbar-config='{
            "customzoom": {
              "tooltipLabel": "zoom",
              "icon": "fa-search",
              "selectable": true,
              "actionConfig": {
                "mousedown": "startZooming",
                "mouseup": "stopZooming",
                "mouseout": "null",
                "mousemove": "null"
              },
              "subConfig": {
                "x": {
                  "title": "X",
                  "tooltipLabel": "Zoom on X axis only",
                  "eventName": "my-custom-click",
                  "selectable": true,
                  "selected": true,
                  "onClick": "function() { this.set(\"selectionType\", \"xAxis\");}"
                },
                "y": {
                  "title": "Y",
                  "tooltipLabel": "Zoom on Y axis only",
                  "selectable": true,
                  "onClick": "function() { this.set(\"selectionType\", \"yAxis\");}"
                },
                "xy": {
                  "title": "XY",
                  "tooltipLabel": "Zoom on X and Y axis",
                  "selectable": true,
                  "onClick": "function() { this.set(\"selectionType\", \"xy\");}"
                },
                "zoomIn": {
                  "icon": "fa-plus",
                  "tooltipLabel": "zoom in",
                  "eventName": "px-vis-toolbar-zoom-in"
                },
                "zoomOut": {
                  "icon": "fa-minus",
                  "tooltipLabel": "zoom out",
                  "eventName": "px-vis-toolbar-zoom-out"
                },
                "undoZoom": {
                  "icon": "fa-undo",
                  "tooltipLabel": "undo zoom",
                  "eventName": "px-vis-toolbar-undo-zoom"
                },
                "resetZoom": {
                  "icon": "fa-expand",
                  "tooltipLabel": "reset zoom to inital value",
                  "eventName": "px-vis-toolbar-reset-zoom"
                }
              }
            },
            "pan": true,
            "tooltip": true,
            "logHover": {
              "tooltipLabel": "run action on click",
              "icon": "fa-leaf",
              "onClick": "function(data) { console.log(\"click on leaf, context:\" + this.outerHTML); console.log(\"click on leaf, data:\" + JSON.stringify(data));}",
              "subConfig": {
                "customClick": {
                  "icon": "fa-coffee",
                  "tooltipLabel": "logs some messages on chart click",
                  "eventName": "my-custom-click",
                  "actionConfig": {
                    "mousedown": "function() {console.log(\"custom mouse down 1 on chart\")}",
                    "mouseup": "function() {console.log(\"custom mouse up 1 on chart\")}",
                    "mousemove": ""
                  }
                },
                "customClick2": {
                  "icon": "fa-fire-extinguisher",
                  "tooltipLabel": "logs some other messages on chart click",
                  "actionConfig": {
                    "mousedown": "function() {console.log(\"custom mouse down 2 on chart\")}",
                    "mouseup": "function() {console.log(\"custom mouse up 2 on chart\")}",
                    "mousemove": "function() { console.log(\"custom hover 2\");}"
                  }
                }
              }
            }
          }'>
        </px-vis-toolbar>
        <px-vis-timeseries
          id="timeSerie"
          height="500"
          selection-type="xAxis"
          show-tooltip
          toolbar-config="{}"
          toolbar-sub-config="[[toolbarSubConfig]]"
          action-config='[[actionConfig]]'
          series-config='{
            "y0": {
              "name":"y0",
              "y":"y0",
              "x": "x"
            },
            "y1": {
              "name":"y1",
              "y":"y1",
              "x": "x"
            }}'
          default-series-config='{
            "type": "line",
            "yAxisUnit": "Hz"
            }'
          dynamic-menu-config='[{
            "name": "Delete",
            "action": "function(data) {  var conf = this.seriesConfig; delete conf[data.additionalDetail.name]; this.set(\"seriesConfig\", {}); this.set(\"seriesConfig\", conf); }",
            "eventName": "delete",
            "icon": "fa-trash"
          },
          {
            "name": "Bring To Front",
            "action": "function(data) {this.set(\"serieToRedrawOnTop\", data.additionalDetail.name);}",
            "eventName": "bring-to-front",
            "icon": "fa-arrow-up"
          }]'
          chart-data="[[chartData]]">
        </px-vis-timeseries>
        <iron-ajax
          id="fetch1"
          url="../px-demo-data/demo-data/aviation/delta-egt-cruise.json"
          handle-as="json"
          auto>
        </iron-ajax>
        <iron-ajax
          id="fetch2"
          url="../px-demo-data/demo-data/aviation/hpt-acc-position-cruise.json"
          handle-as="json"
          auto>
        </iron-ajax>

        <px-vis-data-converter
          id="converter"
          data-key = "series"
          id-key = "name"
          original-data = '[[originalData]]'
          series-config="{{seriesConfig}}"
          chart-data="{{chartData}}">
        </px-vis-data-converter>
        <iron-ajax
          url="../px-demo-data/demo-data/aviation/delta-egt-cruise-events.json"
          handle-as="json"
          auto
          last-response="{{eventData}}">
        </iron-ajax>

        <br />
        <br />
        <h2>Example of a timeseries with mostly default data and using the new data format</h2>
        <px-vis-timeseries
          width = "1000"
          height = "500"
          include-all-series
          toolbar-config="{}"
          toolbar-sub-config="[[toolbarSubConfig]]"
          action-config='[[actionConfig]]'
          selection-type= "xy"
          chart-data="[[chartData2]]"
          register-config='{
              "height": 50,
              "type": "vertical"}'
          x-axis-config='{
            "title": "Date"
          }'
          y-axis-config='{
            "title": "Widgets"
          }'>
        </px-vis-timeseries>
        <iron-ajax
          url="../px-demo-data/demo-data/aviation/delta-egt-cruiseXY.json"
          handle-as="json"
          auto
          last-response="{{chartData2}}"
          >
        </iron-ajax>
    </template>
    <script>
      window.addEventListener('WebComponentsReady', function() {
        setTimeout(function() {
          var chart = document.getElementById('chartCustom'),
              rangepicker = document.getElementById('rangepicker'),
              btnSnap = document.getElementById('btnSnap'),
              timeSerie = document.getElementById('timeSerie'),
              bigChart =  document.getElementById('bigChart'),
              fetch1 = document.getElementById('fetch1'),
              fetch2 = document.getElementById('fetch2'),
              converter = document.getElementById('converter'),
              aggregatedData = [];

            var processData = function(data) {
              aggregatedData.push(data);
              if(aggregatedData.length === 2) {
                converter.set('originalData', aggregatedData);
              }
            };

            //get both set of data for 1st chart
            var handleResponse = function(evt) {
              processData(evt.detail.response);
            }

            fetch1.addEventListener('response', handleResponse);
            fetch2.addEventListener('response', handleResponse);

            //if the data has been fetched already manually kick the event handler
            if(fetch1.lastResponse) {
              processData(fetch1.lastResponse);
            }
            if(fetch2.lastResponse) {
              processData(fetch2.lastResponse);
            }
      });
    });
    </script>
    </body>
</html>
